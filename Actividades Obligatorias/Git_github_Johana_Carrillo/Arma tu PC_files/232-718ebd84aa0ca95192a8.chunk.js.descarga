(("undefined"!==typeof self?self:this).webpackJsonp=("undefined"!==typeof self?self:this).webpackJsonp||[]).push([[232],{1412:function(e,t,o){"use strict";o.r(t);var i,n,r=o(2),d=o(8),a=o(123),s=o(3),l=o(126),p=o(83),c=function(e,t,o,i){var n,r=arguments.length,d=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)d=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(d=(r<3?n(d):r>3?n(t,o,d):n(t,o))||d);return r>3&&d&&Object.defineProperty(t,o,d),d},u=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)};const h=Object(d.d)("draft"),f=Object(d.d)("snackbars"),y=Object(d.d)("composerModal"),g=Object(d.d)("composerModalAlert"),v=Object(d.d)("confirmationDialog"),b=Object(d.d)("dragAndDropEvents"),A=Object(d.d)("post"),m=Object(d.d)("table"),D=Object(d.d)("browser");let k=class extends(Object(r.c)()){constructor(){super(...arguments),this.xBulkActionMenu=!1,this.bulkActionPopoverAnchor={}}get pendingPostReadyToUploadCids(){if(this.isTable)return this.tablePostsToUpload.filter(e=>!!e.file).map(e=>e.cid);const e=this.pendingPosts.filter(e=>!!e.file);if(this.isSectioned){return e.filter(e=>!!e.wall_section_id).map(e=>e.cid)}return e.map(e=>e.cid)}get isComposerModalExpanded(){return this.isAnyDraftActive&&this.isComposerModalExpandedWhenOpened}respondToNewPendingPostsReadyToUpload(e){0!==e.length&&(e.forEach(e=>{const t=this.pendingPostEntitiesByCid[e];t.file&&this.createNewDraftFromPendingUpload({file:t.file,postAttributes:t})}),this.removePendingPosts({cids:e}))}respondToActiveDraftChanges(e){e&&!Object(a.k)(e)&&this.expandComposerModal()}respondToWindowSizeChanges(){this.updateBulkActionPopoverAnchor()}hideMarginStyle(e){return this.draftCids.length<2?{}:this.isCidActiveDraft(e)&&this.isComposerModalExpandedWhenOpened?{marginRight:"0px"}:{}}uploadingFileByCid(e){var t;return null===(t=this.draftByCid(e))||void 0===t?void 0:t.uploadingFile}maxFileUploadSizeByCid(e){var t;return(null===(t=this.draftByCid(e))||void 0===t?void 0:t.maxFileUploadSize)||this.uploadLimit}onUploadError(e,t,o){var i;this.stopUploadFileInDraft({cid:o}),this.stopAutoPublishDraft({cid:o}),this.isCidActiveDraft(o)?this.openAlert({title:this.__("There was an error loading the attachment"),body:t,primaryActionText:this.__("Try again"),secondaryActionText:this.__("Cancel"),primaryActions:[{type:"draft/uploadFileActiveDraft",payload:{file:e,maxFileUploadSize:null===(i=this.draftByCid(o))||void 0===i?void 0:i.maxFileUploadSize}}],secondaryActions:[]}):this.setSnackbar({message:t})}onUploadCancel(e,t){var o;this.stopAutoPublishDraft({cid:t}),(null===(o=this.draftByCid(t))||void 0===o?void 0:o.uploadingFile)&&this.stopUploadFileInDraft({cid:t})}onUploadReject(e,t,o){this.stopUploadFileInDraft({cid:o}),this.stopAutoPublishDraft({cid:o}),this.showOverFileSizeModal({file:e})}onUploadDone(e,t,o){var i;this.stopUploadFileInDraft({cid:o}),this.updateDraft({cid:o,attachment:t,wish_content:{attachment_props:{url:t},is_processed:!1}}),(null===(i=this.draftByCid(o))||void 0===i?void 0:i.shouldAutoPublish)&&this.savePost({attributes:this.draftByCid(o)})}checkUnsavedDraft(e){if(!this.draftCids.some(e=>{const t=this.draftByCid(e);if(!t)return!1;const o=this.getPostByCid(e),i=Object(a.k)(t)&&Object(a.l)(t),n=!!t.uploadingFile,r=t.subject!==(null===o||void 0===o?void 0:o.subject)||t.body!==(null===o||void 0===o?void 0:o.body)||t.attachment!==(null===o||void 0===o?void 0:o.attachment)||t.attachment_caption!==(null===o||void 0===o?void 0:o.attachment_caption);return i||n||r}))return;const t=this.__("It looks like you have unsaved changes. Are you sure you want to discard them and close this page?");return e.returnValue=t,t}openBulkActionMenu(){this.updateBulkActionPopoverAnchor(),this.xBulkActionMenu=!0}closeBulkActionMenu(){this.xBulkActionMenu=!1}updateBulkActionPopoverAnchor(){const e=this.$refs.bulkActionButton;if(!e)return void(this.bulkActionPopoverAnchor={});const t=e.$el.getBoundingClientRect();this.bulkActionPopoverAnchor={top:t.top,left:t.left-18,width:t.width+32}}publishAllDrafts(){this.closeBulkActionMenu();[...this.draftCids].reverse().forEach(e=>{this.publishDraft({cid:e})})}deleteAllDrafts(){this.closeBulkActionMenu(),this.openConfirmationDialog(Object.assign(Object.assign({},l.a),{isCodeProtected:!1,title:this.__("Delete all drafts?"),body:this.__("You can't undo this action."),confirmButtonText:this.__("Delete drafts"),cancelButtonText:this.__("Cancel"),afterConfirmActions:[{type:"draft/deleteAllDrafts"}],buttonScheme:p.a.Danger,forceFullWidthButtons:!0,xShadow:this.isUsingNewSurfaceShadows}))}mounted(){s.a.addEventListener("beforeunload",this.checkUnsavedDraft)}beforeDestroy(){s.a.removeEventListener("beforeunload",this.checkUnsavedDraft)}};c([d.b,u("design:type",Number)],k.prototype,"uploadLimit",void 0),c([d.b,u("design:type",Boolean)],k.prototype,"isSectioned",void 0),c([d.b,u("design:type",Boolean)],k.prototype,"isTable",void 0),c([d.b,u("design:type",Boolean)],k.prototype,"isUsingNewSurfaceShadows",void 0),c([h.Getter,u("design:type","function"===typeof(i="undefined"!==typeof DraftPost&&DraftPost)?i:Object)],k.prototype,"activeDraft",void 0),c([h.Getter,u("design:type",Array)],k.prototype,"draftCids",void 0),c([h.Getter,u("design:type",Function)],k.prototype,"draftByCid",void 0),c([h.Getter,u("design:type",Function)],k.prototype,"isCidActiveDraft",void 0),c([h.Getter,u("design:type",Boolean)],k.prototype,"isAnyDraftActive",void 0),c([h.Getter,u("design:type",Object)],k.prototype,"activeDraftUploadingFile",void 0),c([A.Getter,u("design:type",Array)],k.prototype,"pendingPosts",void 0),c([A.Getter,u("design:type","function"===typeof(n="undefined"!==typeof Record&&Record)?n:Object)],k.prototype,"pendingPostEntitiesByCid",void 0),c([A.Getter,u("design:type",Function)],k.prototype,"getPostByCid",void 0),c([m.Getter("postsPendingUpload"),u("design:type",Array)],k.prototype,"tablePostsToUpload",void 0),c([y.Getter("isExpanded"),u("design:type",Boolean)],k.prototype,"isComposerModalExpandedWhenOpened",void 0),c([b.Getter("isHandlingDragEvent"),u("design:type",Boolean)],k.prototype,"isPageHandlingDragEvent",void 0),c([D.Getter,u("design:type",Number)],k.prototype,"windowWidth",void 0),c([D.Getter,u("design:type",Number)],k.prototype,"windowHeight",void 0),c([d.a,u("design:type",Function)],k.prototype,"showOverFileSizeModal",void 0),c([f.Action,u("design:type",Function)],k.prototype,"setSnackbar",void 0),c([h.Action,u("design:type",Function)],k.prototype,"stopUploadFileInDraft",void 0),c([h.Action,u("design:type",Function)],k.prototype,"updateDraft",void 0),c([h.Action,u("design:type",Function)],k.prototype,"createNewDraftFromPendingUpload",void 0),c([h.Action,u("design:type",Function)],k.prototype,"stopAutoPublishDraft",void 0),c([g.Action,u("design:type",Function)],k.prototype,"openAlert",void 0),c([A.Action,u("design:type",Function)],k.prototype,"removePendingPosts",void 0),c([A.Action,u("design:type",Function)],k.prototype,"savePost",void 0),c([y.Action("expand"),u("design:type",Function)],k.prototype,"expandComposerModal",void 0),c([Object(r.g)("pendingPostReadyToUploadCids"),u("design:type",Function),u("design:paramtypes",[Array]),u("design:returntype",void 0)],k.prototype,"respondToNewPendingPostsReadyToUpload",null),c([Object(r.g)("activeDraft"),u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],k.prototype,"respondToActiveDraftChanges",null),c([Object(r.g)("windowWidth"),Object(r.g)("windowHeight"),u("design:type",Function),u("design:paramtypes",[]),u("design:returntype",void 0)],k.prototype,"respondToWindowSizeChanges",null),c([h.Action,u("design:type",Function)],k.prototype,"publishDraft",void 0),c([v.Action,u("design:type",Function)],k.prototype,"openConfirmationDialog",void 0),k=c([Object(r.a)({components:{SurfaceComposerModalNew:()=>Promise.all([o.e(2),o.e(218),o.e(6),o.e(148)]).then(o.bind(null,1358)),OzBaseButton:()=>Promise.resolve().then(o.bind(null,33)),OzIcon:()=>Promise.resolve().then(o.bind(null,44)),SurfaceDraftBulkActionPopover:()=>Promise.all([o.e(2),o.e(6),o.e(215)]).then(o.bind(null,1432))}})],k);var C=k,P=o(5),B=Object(P.a)(C,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{class:["fixed","top-0","bottom-0","right-0","left-0","pointer-events-none","inline-flex","items-end","flex-row-reverse","space-x-reverse","space-x-4","z-backdrop","pl-8","pr-[6.5rem]",e.isPageHandlingDragEvent&&"bg-grape-500 dark:bg-drag-overlay-dark bg-opacity-50 dark:bg-opacity-35"]},[e.draftCids.length>1?o("div",{staticClass:"flex-shrink-0 pointer-events-auto"},[o("OzBaseButton",{ref:"bulkActionButton",class:["h-10","w-10","p-0","grid","place-items-center","rounded-t-xl","bg-light-ui-100","dark:bg-dark-ui-100","text-dark-text-200 dark:text-light-text-200","hover-hover:hover:text-dark-text-100 hover-hover:dark:hover:text-light-text-100","focus:text-grape-500 dark:focus:text-canary-500","active:text-grape-500 dark:active:text-canary-500",e.isUsingNewSurfaceShadows&&"shadow-elevation-2"],on:{click:e.openBulkActionMenu}},[o("OzIcon",{attrs:{name:"bulk_action",size:24}})],1),e._v(" "),e.xBulkActionMenu?o("SurfaceDraftBulkActionPopover",{attrs:{"popover-anchor":e.bulkActionPopoverAnchor},on:{cancel:e.closeBulkActionMenu,"publish-all":e.publishAllDrafts,"delete-all":e.deleteAllDrafts}}):e._e()],1):e._e(),e._v(" "),e._l(e.draftCids,(function(t){return o("surface-composer-modal-new",{key:t,style:e.hideMarginStyle(t),attrs:{"draft-cid":t,file:e.uploadingFileByCid(t),"max-file-size":e.maxFileUploadSizeByCid(t)},on:{error:function(o,i){return e.onUploadError(o,i,t)},cancel:function(o){return e.onUploadCancel(o,t)},done:function(o,i){return e.onUploadDone(o,i,t)},reject:function(o,i){return e.onUploadReject(o,i,t)}}})}))],2)}),[],!1,null,null,null);t.default=B.exports}}]);
//# sourceMappingURL=232-718ebd84aa0ca95192a8.chunk.js.map